Fix name errors and refactor flake8 config to reduce the chance of future errors. (#1754)